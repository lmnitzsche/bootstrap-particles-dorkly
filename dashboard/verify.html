<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Verification - DorklyAI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #0f0f1e;
            color: #e4e4e7;
            font-family: 'Inter', sans-serif;
            padding: 2rem;
        }
        .card {
            background: #1a1a2e;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .success { color: #38ef7d; }
        .error { color: #f5576c; }
        .info { color: #667eea; }
        h1 { color: #667eea; margin-bottom: 2rem; }
        h3 { color: #ffc107; margin-top: 1.5rem; }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        button:hover { opacity: 0.9; }
        pre {
            background: rgba(0,0,0,0.3);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ DorklyAI Dashboard Verification Tool</h1>
        
        <div class="card">
            <h3>üìä Current localStorage Data</h3>
            <button onclick="viewReps()">View Reps Data</button>
            <button onclick="viewSales()">View Sales Data</button>
            <button onclick="clearAll()">Clear All Data</button>
            <button onclick="resetToDefaults()">Reset to Defaults</button>
            <div id="output" class="mt-3"></div>
        </div>

        <div class="card">
            <h3>‚ûï Quick Add Test Rep</h3>
            <input type="text" id="testName" placeholder="Rep Name" class="form-control mb-2" value="Sarah Chen">
            <input type="email" id="testEmail" placeholder="Rep Email" class="form-control mb-2" value="sarah@dorklyai.com">
            <input type="password" id="testPassword" placeholder="Password" class="form-control mb-2" value="test123">
            <button onclick="addTestRep()">Add Test Rep</button>
            <div id="addRepResult" class="mt-2"></div>
        </div>

        <div class="card">
            <h3>‚ûï Quick Add Test Sale</h3>
            <select id="testRepId" class="form-control mb-2">
                <option value="">Select Rep...</option>
            </select>
            <select id="testPackage" class="form-control mb-2">
                <option value="Web Dev - Starter|1000|200">Web Dev - Starter ($1,000 + $200/mo)</option>
                <option value="Web Dev - Growth|2000|350">Web Dev - Growth ($2,000 + $350/mo)</option>
                <option value="Automation - Starter|1500|300">Automation - Starter ($1,500 + $300/mo)</option>
            </select>
            <input type="text" id="testCustomer" placeholder="Customer Name" class="form-control mb-2" value="Test Company Inc">
            <input type="number" id="testContract" placeholder="Contract Length (months)" class="form-control mb-2" value="12">
            <button onclick="addTestSale()">Add Test Sale</button>
            <div id="addSaleResult" class="mt-2"></div>
        </div>

        <div class="card">
            <h3>üîç Verification Tests</h3>
            <button onclick="runAllTests()">Run All Tests</button>
            <div id="testResults" class="mt-3"></div>
        </div>

        <div class="card">
            <h3>üîó Quick Links</h3>
            <button onclick="window.open('admin.html', '_blank')">Open Admin Dashboard</button>
            <button onclick="window.open('sales-rep.html', '_blank')">Open Sales Rep Dashboard</button>
        </div>

        <div class="card">
            <h3>üìù Test Credentials</h3>
            <p><strong class="info">Admin:</strong><br>
            Email: admin@dorklyai.com<br>
            Password: admin123</p>
            
            <p><strong class="info">Sales Reps (Default):</strong><br>
            Tyler: tyler@dorklyai.com / rep123<br>
            Ashley: ashley@dorklyai.com / rep123<br>
            Marcus: marcus@dorklyai.com / rep123</p>
        </div>
    </div>

    <script>
        function viewReps() {
            const reps = JSON.parse(localStorage.getItem('dorklyai_reps')) || [];
            document.getElementById('output').innerHTML = `
                <h5 class="success">Reps in localStorage (${reps.length}):</h5>
                <pre>${JSON.stringify(reps, null, 2)}</pre>
            `;
            updateRepDropdown();
        }

        function viewSales() {
            const sales = JSON.parse(localStorage.getItem('dorklyai_sales')) || [];
            document.getElementById('output').innerHTML = `
                <h5 class="success">Sales in localStorage (${sales.length}):</h5>
                <pre>${JSON.stringify(sales, null, 2)}</pre>
            `;
        }

        function clearAll() {
            if (confirm('This will delete ALL reps and sales data. Continue?')) {
                localStorage.removeItem('dorklyai_reps');
                localStorage.removeItem('dorklyai_sales');
                document.getElementById('output').innerHTML = '<p class="success">‚úì All data cleared!</p>';
                updateRepDropdown();
            }
        }

        function resetToDefaults() {
            const defaultReps = [
                { id: 1, name: 'Tyler Rodriguez', email: 'tyler@dorklyai.com', password: 'rep123' },
                { id: 2, name: 'Ashley Thompson', email: 'ashley@dorklyai.com', password: 'rep123' },
                { id: 3, name: 'Marcus Johnson', email: 'marcus@dorklyai.com', password: 'rep123' }
            ];
            localStorage.setItem('dorklyai_reps', JSON.stringify(defaultReps));
            localStorage.setItem('dorklyai_sales', JSON.stringify([]));
            document.getElementById('output').innerHTML = '<p class="success">‚úì Reset to default 3 reps, 0 sales</p>';
            updateRepDropdown();
        }

        function addTestRep() {
            const reps = JSON.parse(localStorage.getItem('dorklyai_reps')) || [];
            const name = document.getElementById('testName').value;
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;

            if (!name || !email || !password) {
                document.getElementById('addRepResult').innerHTML = '<p class="error">Please fill all fields</p>';
                return;
            }

            // Check if email exists
            if (reps.some(r => r.email === email)) {
                document.getElementById('addRepResult').innerHTML = '<p class="error">Email already exists!</p>';
                return;
            }

            const newRep = {
                id: Date.now(),
                name: name,
                email: email,
                password: password
            };

            reps.push(newRep);
            localStorage.setItem('dorklyai_reps', JSON.stringify(reps));
            
            document.getElementById('addRepResult').innerHTML = `
                <p class="success">‚úì Added: ${name} (${email})</p>
                <p class="info">They can now login to sales-rep.html with this email and password</p>
            `;
            updateRepDropdown();
        }

        function addTestSale() {
            const reps = JSON.parse(localStorage.getItem('dorklyai_reps')) || [];
            const sales = JSON.parse(localStorage.getItem('dorklyai_sales')) || [];
            
            const repId = parseInt(document.getElementById('testRepId').value);
            const packageData = document.getElementById('testPackage').value.split('|');
            const customer = document.getElementById('testCustomer').value;
            const contractLength = parseInt(document.getElementById('testContract').value);

            if (!repId || !packageData || !customer) {
                document.getElementById('addSaleResult').innerHTML = '<p class="error">Please fill all fields</p>';
                return;
            }

            const rep = reps.find(r => r.id === repId);
            const [packageName, setupFee, monthlyFee] = packageData;

            const setup = parseFloat(setupFee);
            const monthly = parseFloat(monthlyFee);
            
            // Calculate commissions (15%, 20%, 10%)
            const setupComm = setup * 0.15;
            const year1Months = Math.min(12, contractLength);
            const year1Comm = monthly * 0.20 * year1Months;
            const year2Months = Math.max(0, contractLength - 12);
            const year2Comm = monthly * 0.10 * year2Months;
            const totalComm = setupComm + year1Comm + year2Comm;
            const totalValue = setup + (monthly * contractLength);

            const newSale = {
                id: Date.now(),
                date: new Date().toISOString(),
                repId: repId,
                repName: rep.name,
                course: packageName,
                customerName: customer,
                customerEmail: customer.toLowerCase().replace(/\s+/g, '') + '@example.com',
                contractStart: new Date().toISOString().split('T')[0],
                contractLength: contractLength,
                paymentDay: 1,
                setupFee: setup.toFixed(2),
                monthlyFee: monthly.toFixed(2),
                totalContractValue: totalValue.toFixed(2),
                setupCommissionRate: 15,
                year1CommissionRate: 20,
                year2CommissionRate: 10,
                setupCommission: setupComm.toFixed(2),
                year1Commission: year1Comm.toFixed(2),
                year2Commission: year2Comm.toFixed(2),
                totalCommission: totalComm.toFixed(2),
                status: 'active',
                notes: 'Test sale'
            };

            sales.unshift(newSale);
            localStorage.setItem('dorklyai_sales', JSON.stringify(sales));
            
            document.getElementById('addSaleResult').innerHTML = `
                <p class="success">‚úì Added sale for ${rep.name}</p>
                <p class="info">Commission: $${totalComm.toFixed(2)} (Setup: $${setupComm.toFixed(2)} + Recurring)</p>
            `;
        }

        function updateRepDropdown() {
            const reps = JSON.parse(localStorage.getItem('dorklyai_reps')) || [];
            const select = document.getElementById('testRepId');
            select.innerHTML = '<option value="">Select Rep...</option>';
            reps.forEach(rep => {
                select.innerHTML += `<option value="${rep.id}">${rep.name}</option>`;
            });
        }

        function runAllTests() {
            const results = [];
            const reps = JSON.parse(localStorage.getItem('dorklyai_reps')) || [];
            const sales = JSON.parse(localStorage.getItem('dorklyai_sales')) || [];

            // Test 1: Reps exist
            if (reps.length >= 3) {
                results.push('<p class="success">‚úì Test 1: Found ' + reps.length + ' reps in localStorage</p>');
            } else {
                results.push('<p class="error">‚úó Test 1: Only ' + reps.length + ' reps found (expected at least 3)</p>');
            }

            // Test 2: Reps have passwords
            const repsWithPasswords = reps.filter(r => r.password);
            if (repsWithPasswords.length === reps.length) {
                results.push('<p class="success">‚úì Test 2: All reps have passwords</p>');
            } else {
                results.push('<p class="error">‚úó Test 2: ' + (reps.length - repsWithPasswords.length) + ' reps missing passwords</p>');
            }

            // Test 3: Check default reps
            const tyler = reps.find(r => r.email === 'tyler@dorklyai.com');
            if (tyler && tyler.password === 'rep123') {
                results.push('<p class="success">‚úì Test 3: Tyler Rodriguez exists with correct credentials</p>');
            } else {
                results.push('<p class="error">‚úó Test 3: Tyler Rodriguez missing or wrong password</p>');
            }

            // Test 4: Sales structure
            if (sales.length > 0) {
                const firstSale = sales[0];
                if (firstSale.totalCommission && firstSale.setupCommission && firstSale.contractLength) {
                    results.push('<p class="success">‚úì Test 4: Sales have new commission structure</p>');
                } else {
                    results.push('<p class="error">‚úó Test 4: Sales missing new commission fields</p>');
                }
            } else {
                results.push('<p class="info">‚äò Test 4: No sales to test (add a test sale above)</p>');
            }

            // Test 5: Rep-Sale linking
            if (sales.length > 0) {
                const orphanedSales = sales.filter(s => !reps.find(r => r.id === s.repId));
                if (orphanedSales.length === 0) {
                    results.push('<p class="success">‚úì Test 5: All sales linked to valid reps</p>');
                } else {
                    results.push('<p class="error">‚úó Test 5: ' + orphanedSales.length + ' sales have invalid repId</p>');
                }
            } else {
                results.push('<p class="info">‚äò Test 5: No sales to test</p>');
            }

            document.getElementById('testResults').innerHTML = results.join('');
        }

        // Initialize
        updateRepDropdown();
    </script>
</body>
</html>
